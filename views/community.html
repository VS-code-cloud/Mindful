<!DOCTYPE html>
<html>
  <head>
    <title>Mindful</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <link rel="icon" type="image/x-icon" href="/static/images/WildBlueIcon.png">

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="static/css/main.css">
  <link rel='stylesheet' href='static/css/signup.css'>

    <link rel='stylesheet' href='static/css/toast.css'>
        <link rel='stylesheet' href='static/css/home.css'><script src="https://kit.fontawesome.com/1f81daf62b.js" crossorigin="anonymous"></script>
  </head>
  <body>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

        <script src='static/js/index.js'></script>
    <script>
      var userData = JSON.parse(localStorage.getItem("userData"));
      if (!userData) {
        window.location.replace("login")
      } else if (!localStorage.getItem("currCommunity")){
        localStorage.setItem("currCommunity", userData.groups[0])
      }
    </script>

      <div class='navFoot'>
        <div onclick="window.location.replace('chat')"><svg xmlns="http://www.w3.org/2000/svg" height="6vw" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#3f0049}</style><path d="M208 352c114.9 0 208-78.8 208-176S322.9 0 208 0S0 78.8 0 176c0 38.6 14.7 74.3 39.6 103.4c-3.5 9.4-8.7 17.7-14.2 24.7c-4.8 6.2-9.7 11-13.3 14.3c-1.8 1.6-3.3 2.9-4.3 3.7c-.5 .4-.9 .7-1.1 .8l-.2 .2 0 0 0 0C1 327.2-1.4 334.4 .8 340.9S9.1 352 16 352c21.8 0 43.8-5.6 62.1-12.5c9.2-3.5 17.8-7.4 25.3-11.4C134.1 343.3 169.8 352 208 352zM448 176c0 112.3-99.1 196.9-216.5 207C255.8 457.4 336.4 512 432 512c38.2 0 73.9-8.7 104.7-23.9c7.5 4 16 7.9 25.2 11.4c18.3 6.9 40.3 12.5 62.1 12.5c6.9 0 13.1-4.5 15.2-11.1c2.1-6.6-.2-13.8-5.8-17.9l0 0 0 0-.2-.2c-.2-.2-.6-.4-1.1-.8c-1-.8-2.5-2-4.3-3.7c-3.6-3.3-8.5-8.1-13.3-14.3c-5.5-7-10.7-15.4-14.2-24.7c24.9-29 39.6-64.7 39.6-103.4c0-92.8-84.9-168.9-192.6-175.5c.4 5.1 .6 10.3 .6 15.5z"/></svg></div>

        <div onclick="window.location.replace('home')"><svg xmlns="http://www.w3.org/2000/svg" height="6vw" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#3f0049}</style><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg></div>

        <div class='active'><svg xmlns="http://www.w3.org/2000/svg" height="6vw" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><style>svg{fill:#3f0049}</style><path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM609.3 512H471.4c5.4-9.4 8.6-20.3 8.6-32v-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2h61.4C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"/></svg></div>

      </div>
      <div id='community'>

        <div id="postsContainer" class='main'>
          <h1 style="min-margin-bottom: 0vh; min-width: auto" id="postLabel">Your People</h1>


          <div class='flex'>
          <button class='fc' onclick="window.location.href='/post'">Post +</button>
          
          <form action="javascript:updateGroup()" class='gSelectForm'>
            <select name="groupsSelect" id="groupsSelect">
            </select>
            <script>
              let groups = ["Anxiety", "Depression", "Anxiety", "ADHD", "OCD", "PTSD", "Bipolar Disorder", "Borderline Personality Disorder"]
              let gOpts = document.getElementById("groupsSelect")
              for (let i=0; i<groups.length; i++) {
                group = groups[i]
                gOpts.innerHTML+=`<option value="${group}">${group}</option>`
              }
            </script>
            <input type="submit" value="Go">
            
          </form>
          </div>

          
        </div>
        
      <script>
        //document.getElementById("postLabel").innerText=localStorage.getItem("currCommunity")
      </script>
      </div>

        <script>
          async function initPosts() {
            const url = 'https://fakespotlessexperiment.randomcodingboy.repl.co/api/post/group/'+encodeURI(localStorage.getItem("currCommunity"));

      const response = await fetch(url);
      var text = await response.json();
            if (text && typeof text == "object") {
              text= Array.from(text)
            }
      var container = document.getElementById("postsContainer");
      for(var i = 0; i < text.length; i++) {
      let post = text[i]
      container.innerHTML+=(`<div class='post'>
      <h4>By ${post.authorName}</h4>
            <h2>${post.title}</h2>
            <p>${post.content}</p>
            <h5>${new Date(post.timestamp)}</h5>
          </div>`);
      }
          }
        initPosts()

        </script>
      </div>
    <script>
      function updateGroup() {
        var value = document.getElementById("groupsSelect").value;

                localStorage.setItem("currCommunity", value)
        window.location.reload()
      }
    </script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.min.js" integrity="sha512-uWk2ZXl3GVrq6DZsrL5dSg1S/F3MNQ9VaDFigqXOoKUnWG58UxOuJGfTrzh5KjpoBvPiFniL2PahU2HUTFMJXw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
      <script type="text/javascript">
        const firebaseConfig = {
          apiKey: "AIzaSyBCl9ofom-aAS--QLRpEPL8ryoRXn32QkA",
          authDomain: "therapy-92ac2.firebaseapp.com",
          projectId: "therapy-92ac2",
          storageBucket: "therapy-92ac2.appspot.com",
          messagingSenderId: "83184674075",
          appId: "1:83184674075:web:ff32343fc2e8f6a0819fbe",
          measurementId: "G-MY9M225VEE"
        };
      const firebaseApp = firebase.initializeApp(firebaseConfig);
      const auth = firebaseApp.auth();
      function handleSignOut() {

                firebaseApp.auth().signOut().then((x) => {
          localStorage.removeItem("currCommunity")
          localStorage.removeItem("userData")
          window.location.href="/"                               }).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          alert(errorMessage);
          console.log(error);
        })
      }

        document.getElementById('signingout').addEventListener('click', handleSignOut, false);
      </script>
  </body>
</html>